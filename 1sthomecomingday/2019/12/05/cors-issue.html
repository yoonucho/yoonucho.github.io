<!DOCTYPE html>
<html>
  <head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="author" content="yoonucho" />
	<meta name="description" content="조윤우의 블로그입니다." />
	<meta name="keywords" content="조윤우 블로그" />
	<meta property="og:title" content="조윤우의 블로그입니다." />
	<meta property="og:description" content="조윤우의 블로그입니다." />
	<meta property="og:image" content="https://yoonucho.github.io/renewal/img/og_yoonu.jpg" />
	<title>
		냥터레스트, CORS를 모르는 프론트엔드 아깽이
	</title>
	<!-- favicon & icon -->
	<link rel="shortcut icon" href="/ico/favicon.ico" />
	<link rel="icon" href="/ico/icon_16.png" sizes="16x16" />
	<link rel="icon" href="/ico/icon_32.png" sizes="32x32" />
	<link rel="icon" href="/ico/icon_64.png" sizes="64x64" />
	<link rel="icon" href="/ico/icon_144.png" sizes="144x144" />

	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
	<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="/style.css" />
	<link rel="canonical" href="https://yoonucho.github.io/1sthomecomingday/2019/12/05/cors-issue.html" />
	<link rel="alternate" type="application/rss+xml" title="윤우블로그"
		href="https://yoonucho.github.io/feed.xml" />

	<!-- syntax.css -->
	<link rel="stylesheet" href="/syntax.css" />

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-130856644-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() {
			dataLayer.push(arguments);
		}
		gtag("js", new Date());

		gtag("config", "UA-130856644-1");
	</script>
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-EZ53YR7BPP"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-EZ53YR7BPP');
	</script>

	<!-- Google AdSense -->
	<script data-ad-client="ca-pub-1871373979449169" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

  <body>
    <div class="wrapper">
	<input data-function="swipe" id="swipe" type="checkbox" />
	<label data-function="swipe" for="swipe" class="btn btn-default"
		>Menu</label
	>

	<div class="content"><article class="post" itemscope itemtype="https://schema.org/BlogPosting">
  <header class="post-header">
    <h2>냥터레스트, CORS를 모르는 프론트엔드 아깽이</h2>
    <p class="post-meta">
      <time
        datetime="2019-12-05T00:00:00+00:00"
        itemprop="datePublished"
        >Dec 5, 2019</time
      >
    </p>
    <hr />
  </header>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-1871373979449169"
     data-ad-slot="3248859537"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

  <div class="post-content" itemprop="articleBody"><h2 id="시연-영상-추가">시연 영상 추가</h2>

<ul>
  <li>
    <p>프론트엔드(localhost:3000)에서 백엔드(localhost:8080)에 자원을 요청한 상태일때 시연 영상을 찍어 보았습니다.</p>
  </li>
  <li>
    <p>영상의 상단은 CORS이슈 발생 상황이고, 하단은 Express 미들웨어 CORS모듈을 설치 후 실행했을때 화면입니다.</p>

    <ul class="youtube-list">
 <li>
     <div class="youtube-wrap">
         <iframe width="1024" height="600" src="https://www.youtube.com/embed/TIE8-qyvkRQ?showsearch=0&amp;rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
     </div>
 </li>
 <li>
     <div class="youtube-wrap">
         <iframe width="1024" height="600" src="https://www.youtube.com/embed/ptFp-RoqDd0?showsearch=0&amp;rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
     </div>
 </li>


</ul>
  </li>
</ul>
<h2 id="간단-소개">간단 소개</h2>

<ul>
  <li>
    <p>안녕하세요. 정혜인님과 사이드 프로젝트 냥터레스트를 진행중인 조윤우라고 합니다.</p>
  </li>
  <li>
    <p>냥터레스트는 유기묘 정보를 제공해주는 웹서비스이며 프론트엔드는 React, 백엔드는 node.js로 구성되어 있습니다.</p>
  </li>
  <li>
    <p>냥터레스트에 대한 좀 더 자세한 내용은 <a href="https://yoonucho.github.io/side_project/2019/10/14/nyangterest_view.html" target="_blank">사이드 프로젝트 냥터레스트</a>에 있습니다.</p>
  </li>
  <li>
    <p>냥터레스트를 진행하면서 겪은 문제점이 많은데 그중 CORS 이슈에 대해서 여러분들과 공유해보려고 합니다.</p>
  </li>
  <li>
    <p>내용은 당시 겪었던 내용에 발표자료를 준비하면서 테스트한 내용을 추가하였습니다.</p>
  </li>
</ul>

<h2 id="문제발생">문제발생!</h2>

<ul>
  <li>유기묘들의 정보를 <a href="https://www.data.go.kr/" target="_blank">공공데이터포털</a>에서 제공받았는데 API주소를 프론트쪽에 직접적으로 넣으면 이슈를 뿜는걸 처음으로 알게 되었습니다.</li>
</ul>

<p><img src="https://yoonucho.github.io/post_img/cors1.jpg" alt="error_msg" title="안녕 CORS 이슈 월드에 온 것을 환영해" /></p>

<ul>
  <li>말로만 듣던 CORS 이슈를 정면으로 마주하게 되었습니다. 😢</li>
</ul>

<h2 id="3가지-키워드">3가지 키워드</h2>

<ul>
  <li>우선 내용을 좀 더 쉽게 이해하실 수 있도록 3가지 키워드에 대해서 설명을 해보려고 합니다.</li>
</ul>

<h3 id="cors">CORS</h3>

<ul>
  <li>
    <p>CORS? Cross-Origin Resource Sharing의 약자로 교차 출처 자원 공유를 말합니다.</p>
  </li>
  <li>
    <p>서버와 클라이언트가 정해진 헤더를 통해 서로 요청이나 응답에 반응할지 결정하는 방식입니다.</p>
  </li>
  <li>
    <p>원래 도메인과 다른 도메인에서 요청한 웹페이지 자원에 대해 허가하는 메커니즘을 말합니다.</p>
  </li>
  <li>
    <p>SOP를 우회하는 방법중 하나입니다.</p>
  </li>
</ul>

<h3 id="sop">SOP</h3>

<ul>
  <li>
    <p>Same-origin policy의 약자로 동일출처정책을 말합니다.</p>
  </li>
  <li>
    <p>어떤 출처에서 불러온 문서나 스크립트가 다른 출처에서 가져온 리소스와 상호작용을 하는것을 제한하는 중요한 보안방식입니다.</p>
  </li>
  <li>
    <p>Cross Domain Issue에 대한 근본적인 원인이기도 합니다.</p>
  </li>
  <li>
    <p>두 페이지의 프로토콜, 호스트, 포트가 같아야 합니다.</p>
  </li>
</ul>

<h3 id="cross-domain-issue">Cross Domain Issue</h3>

<ul>
  <li>데이터를 호출하는 도메인과 데이터를 반환하는 도메인이 다른것을 말합니다.</li>
</ul>

<h2 id="방법모색-1-테스트">방법모색 1 (테스트)</h2>

<ul>
  <li>
    <p>CORS 이슈를 해결하기 위해서 프론트에서만 해결할 수 있는 방법들을 모색하였습니다.  당시에는 백엔드 세팅을 안하고 간단하게 테스트만 해보고 싶었습니다.</p>

    <ol>
      <li>
        <p>크롬확장 프로그램 설치 - <a href="https://chrome.google.com/webstore/detail/allow-cors-access-control/lhobafahddgcelffkeicbaginigeejlf" target="_blank">Allow CORS: Access-Control-Allow-Origin</a></p>
      </li>
      <li>
        <p>크롬에서 –disable-web-security 옵션을 추가하고 실행</p>
      </li>
      <li>
        <p>JSONP방식으로 요청</p>
      </li>
      <li>
        <p>API 요청서버에서 CORS 설정을 지원하는지 확인</p>
      </li>
    </ol>
  </li>
  <li>
    <p>3번은  여러 보안상 이슈로 인하여 W3C에서는 2009년 채택된 CORS 방식의 HTTP 통신을 권장하고 있다고 해서 패스하였고</p>
  </li>
  <li>
    <p>4번은 공공데이터포털에서 CORS 이슈에 대한 문서를 제공하는 걸 보니 CORS설정을 지원하지는 않는거 같아 1번과 2번을 시도하게 되었습니다.</p>
  </li>
</ul>

<h2 id="시도결과">시도결과</h2>

<ol>
  <li>Allow CORS: Access-Control-Allow-Origin 설치</li>
</ol>

<ul>
  <li>
    <p>냥터레스트에 적용할 당시에 있던 크롬확장프로그램은 없어졌습니다.</p>
  </li>
  <li>
    <p>같은 기능을 하는 다른 확장프로그램을 설치하였고 화면이 제대로 나오는걸 확인할 수 있었습니다.</p>

    <ul>
      <li>
        <p>Before		
<img src="https://yoonucho.github.io/post_img/cors2.jpg" alt="sop우회전" /></p>
      </li>
      <li>
        <p>After
<img src="https://yoonucho.github.io/post_img/cors3.jpg" alt="sop우회1" /></p>
      </li>
    </ul>
  </li>
</ul>

<ol>
  <li>–disable-web-security 옵션추가</li>
</ol>

<ul>
  <li>
    <p>크롬 바로가기에 오른쪽마우스를 클릭하고 속성을 열어서 –disable-web-security을 추가해보았습니다. 하지만 달라지는게 없었습니다.</p>
  </li>
  <li>
    <p>다시 검색해보니 –disable-web-security에 –user-data-dir=”C:\chrome”를 추가하고 아이콘을 실행하면  C드라이브에 chrome이라는 폴더와 데이터가 생성이 되며 도메인 이슈를 무시하는 브라우저가 새로 열립니다.</p>
  </li>
</ul>

<p><img src="https://yoonucho.github.io/post_img/cors4.jpg" alt="sop우회2" /></p>

<h2 id="방법-모색2">방법 모색2</h2>

<ul>
  <li>
    <p>1번과 2번은 개발자가 테스트하기에는 편리한거 같습니다. 하지만 사용자에게 크롬에 확장프로그램을 추가하게 하거나 옵션추가를 요구할 수는 없지요</p>
  </li>
  <li>
    <p>어짜피 백엔드에서 설정을 해주어야 한다는 사실을 깨닫게 되었습니다.</p>
  </li>
</ul>

<h2 id="해결과정">해결과정</h2>

<ol>
  <li>
    <p>서버 응답헤더에 직접 추가 코드를 설정</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         <span class="nx">app</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="dl">"</span><span class="s2">/*</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
             <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Access-Control-Allow-Methods</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GET, POST, OPTIONS</span><span class="dl">"</span><span class="p">);</span>
             <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Access-Control-Max-Age</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">3600</span><span class="dl">"</span><span class="p">);</span>
             <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span>
                 <span class="dl">"</span><span class="s2">Access-Control-Allow-Headers</span><span class="dl">"</span><span class="p">,</span>
                 <span class="dl">"</span><span class="s2">Origin, Accept, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers</span><span class="dl">"</span>
             <span class="p">);</span>
         <span class="p">});</span>

</code></pre></div>    </div>
  </li>
  <li>
    <p>Express 미들웨어 CORS모듈을 설치</p>

    <ul>
      <li>npm install cors –save</li>
    </ul>

    <p>// server.js (서버 localhost:8080)</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
     <span class="kd">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">cors</span><span class="dl">"</span><span class="p">);</span>
     <span class="kd">const</span> <span class="nx">fetch</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">node-fetch</span><span class="dl">"</span><span class="p">);</span>

     <span class="c1">// 중략</span>

     <span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="nx">fetch</span><span class="p">(</span>
             <span class="dl">"</span><span class="s2">openapi.animal.go.kr/openapi/service/rest/abandonmentPublicSrvc/abandonmentPublic?serviceKey=</span><span class="dl">"</span><span class="err">발급받은</span> <span class="err">서비스키</span><span class="dl">"</span><span class="s2">
         )
             .then(response =&gt; response.json())
             .then(json =&gt; {
                 res.send(json);
             })
             .catch(() =&gt; {
                 res.send(JSON.stringify({ message: </span><span class="dl">"</span><span class="nx">System</span> <span class="nb">Error</span><span class="dl">"</span><span class="s2"> }));
             });
     });

     // 중략
     app.use(cors());

</span></code></pre></div>    </div>

    <p>// App.js (프론트 localhost:3000)</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
 <span class="c1">// 중략</span>

     <span class="nx">callApi</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">localhost:8080</span><span class="dl">"</span><span class="p">)</span>
             <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
             <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">json</span> <span class="o">=&gt;</span> <span class="nx">json</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">item</span><span class="p">)</span>
             <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
     <span class="p">};</span>

 <span class="c1">// 중략	</span>

</code></pre></div>    </div>
  </li>
</ol>

<h2 id="삽질-이유를-정리해보자면">삽질 이유를 정리해보자면</h2>

<ol>
  <li>
    <p>냥터레스트를 진행하기 전에 비슷한 튜토리얼을 보면서 따라 만들어봤었는데  당시 이용했던 API는 CORS설정을 지원해주는 API여서 별도의 백엔드설정은 없었던 것을 이제야 알게 되었습니다.</p>
  </li>
  <li>
    <p>어짜피 있어야 할 서버인데 서버를 만들고 싶지 않은 이상한 고집때문에 며칠을 몸고생 맘고생을 하였습니다. 😔</p>
  </li>
  <li>
    <p>전체적인 흐름을 이해하지 못한게 가장 큰 원인이라 생각하였습니다.</p>
  </li>
</ol>

<h2 id="느낀점">느낀점</h2>

<ol>
  <li>
    <p>고집을 부리면 몸과 마음이 고생한다는걸 몸소 느꼈습니다. 아니다 싶으면 빨리 포기할 줄도 알아야 한다고 생각했습니다.</p>
  </li>
  <li>
    <p>사실 몇 달전에 혼자 진행하다 보류한 사이드 프로젝트가 있었는데 그 때는 CORS모듈이 왜 필요한지도 모르고 설치를 했어서 이런 문제는 겪어본적이 없이</p>

    <p>무난히 지나갔었습니다. 그당시 그냥 지나간 댓가를 톡톡히 치뤘다고 생각합니다. 작은 모듈 설치도 가볍게 여기지 말자는 생각을 했습니다.</p>
  </li>
</ol>

<h2 id="참고-사이트">참고 사이트</h2>

<ul>
  <li>
    <p><a href="http://guswnsxodlf.github.io/enable-CORS-on-express" target="_blank">node.js express에서 CORS 허용하기</a></p>
  </li>
  <li>
    <p><a href="https://sjh836.tistory.com/96" target="_blank">CORS vs JSONP</a></p>
  </li>
  <li>
    <p><a href="https://zetawiki.com/wiki/%ED%81%AC%EB%A1%9C%EC%8A%A4-%EC%98%A4%EB%A6%AC%EC%A7%84_%EB%A6%AC%EC%86%8C%EC%8A%A4_%EA%B3%B5%EC%9C%A0_CORS" target="_blank">크로스-오리진 리소스 공유 CORS</a></p>
  </li>
  <li>
    <p><a href="https://www.slideshare.net/DohunKim2/about-cors?qid=04c92f17-1eff-4829-8dc7-c64f91f6f114&amp;v=&amp;b=&amp;from_search=1" target="_blank">CORS (Cross-Origin Resource Sharing)와 SOP(Same Origin Policy)에 대한 이해</a></p>
  </li>
  <li>
    <p><a href="https://velog.io/@yesdoing/JSONP%EB%9E%80-jujowt4jy7" target="_blank">JSONP란?</a></p>
  </li>
</ul>
</div>

  <!-- To enable Disqus comments, comment out this code and insert your Disqus shortname -->

  
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = "yoonucho"; // required: replace example with your forum shortname
    var disqus_developer = 1; // Comment out when the site is live
    var disqus_identifier = "/1sthomecomingday/2019/12/05/cors-issue.html";

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement("script");
      dsq.type = "text/javascript";
      dsq.async = true;
      dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
      (
        document.getElementsByTagName("head")[0] ||
        document.getElementsByTagName("body")[0]
      ).appendChild(dsq);
    })();
  </script>
  <noscript
    >Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript"
      >comments powered by Disqus.</a
    ></noscript
  >
  <a href="https://disqus.com" class="dsq-brlink"
    >comments powered by <span class="logo-disqus">Disqus</span></a
  >
  
</article>
</div>

	<div class="sidebar menu">
		<div
			id="picture"
			style="background-image: url(https://yoonucho.github.io/post_img/yoonu.png)"
		></div>
		<!-- <p>One sentence introducing yourself or what you do</p> -->

		<hr />

		<p>윤우 블로그</p>

		<hr />

		<div id="social-icons">
			<ul>
				<li>
					<a href="https://github.com/yoonucho" title="깃헙" target="_blank"><i
							class="fa fa-github"></i></a>
				</li>
				<li>
					<a href="https://t.me/tomorrowcho" title="텔레그램" target="_blank"><i
							class="fa fa-telegram"></i></a>
				</li>
			</ul>
		</div>

		<hr />

		<div class="navigation">
			<ul>
				   
				<li>
					<a href="/about/">About</a>
				</li>
				  
				<li>
					<a href="/">Blog</a>
				</li>
				                           
			</ul>
		</div>

		<hr />

		<div class="navigation">
			<ul>
				
				<li>
					<a
						href="/categories/issue_note"
						>issue_note</a
					>
				</li>
				
				<li>
					<a
						href="/categories/git"
						>git</a
					>
				</li>
				
				<li>
					<a
						href="/categories/review"
						>review</a
					>
				</li>
				
				<li>
					<a
						href="/categories/book_list"
						>book_list</a
					>
				</li>
				
				<li>
					<a
						href="/categories/side_project"
						>side_project</a
					>
				</li>
				
				<li>
					<a
						href="/categories/1stHomecomingday"
						>1stHomecomingday</a
					>
				</li>
				
			</ul>
		</div>

		<hr />

		<p>yoonu blog</p>
		<p></p>
		<p>Powered by Jekyll</p>
		<p></p>
	</div>
</div>


    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-2.x-git.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <!-- <script src="/js/index.js"></script> -->
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 상단사각 -->
	<ins class="adsbygoogle"
		style="display:block;text-align: center;"
		data-ad-client="ca-pub-1871373979449169"
		data-ad-slot="5339836252"
		data-ad-format="auto"
		data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
  </body>

  <script>
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
  </script>

  <script>
    $(document).ready(function() {
      $("#page-content-wrapper").fadeIn();
    });
  </script>
</html>
